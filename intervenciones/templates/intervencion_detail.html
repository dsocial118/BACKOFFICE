{% extends "includes/main.html" %}
{% load static %}

{% block title %}Intervenciones{% endblock %}
{% block titulo-pagina %}Intervenciones{% endblock %}

{% block breadcrumb %}
<ol class="breadcrumb float-sm-right">
    <li class="breadcrumb-item">
        <a href="{% url 'comedor_detalle' object.id %}" title="Ver Comedor">{{ object.nombre }}</a>
    </li>
    <li class="breadcrumb-item active">Intervenciones</li>
</ol>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 my-3 mx-2 d-print-none">
        <a href="{% url 'comedor_intervencion_crear' object.id %}" class="btn btn-primary mr-1">Agregar Intervención</a>
    </div>
</div>

<!-- Filtros -->
<div class="row">
    <div class="col-12">
        <form method="get" class="form-inline mb-3">
            <input type="date" name="fecha" class="form-control mr-2" placeholder="Fecha" value="{{ request.GET.fecha }}">
            <select name="tipo_intervencion" class="form-control mr-2">
                <option value="">Tipo de Intervención</option>
                {% for tipo in tipos_intervencion %}
                    <option value="{{ tipo.id }}" {% if tipo.id|stringformat:"s" == request.GET.tipo_intervencion %}selected{% endif %}>
                        {{ tipo.nombre }}
                    </option>
                {% endfor %}
            </select>
            <input type="text" name="destinatario" class="form-control mr-2" placeholder="Destinatario" value="{{ request.GET.destinatario }}">
            <button type="submit" class="btn btn-primary">Filtrar</button>
        </form>
    </div>
</div>

<!-- Tabla de intervenciones -->
<div class="row">
    <div class="col-12">
        <div class="card card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title">Historial de Intervenciones</h3>
            </div>
            <div class="card-body table-responsive">
                {% if intervenciones %}
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo de Intervención</th>
                                <th>Subtipo de Intervención</th>
                                <th>Destinatario</th>
                                <th>Forma de Contacto</th>
                                <th>Documentación Adjunta</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for intervencion in intervenciones %}
                                <tr>
                                    <td>{{ intervencion.fecha|date:"d/m/Y" }}</td>
                                    <td>{{ intervencion.tipo_intervencion }}</td>
                                    <td>{{ intervencion.subintervencion }}</td>
                                    <td>{{ intervencion.destinatario }}</td>
                                    <td>{{ intervencion.forma_contacto }}</td>
                                    <td>
                                        {% if intervencion.tiene_documentacion %}
                                            Sí
                                        {% else %}
                                            No
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'intervencion_editar' intervencion.id %}" class="btn btn-sm btn-warning">Editar</a>
                                        <a href="{% url 'intervencion_borrar' intervencion.id %}" class="btn btn-sm btn-danger">Eliminar</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="text-center">Aún no se han registrado intervenciones</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}