{% load static custom_filters %}
{% with pagina_actual=request.resolver_match.route %}
    <li class="nav-item">
        <a href="{% url 'dashboard' %}"
           class="nav-link {% if 'dashboard' in pagina_actual %}active{% endif %}">
            <i class="nav-icon fas fa-chart-pie"></i>
            <p>Dashboard</p>
        </a>
    </li>
    {% if request.user|has_group:"Administrador" %}
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="nav-icon fas fa-users"></i>
                <p>
                    Administración
                    <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="{% url 'usuarios' %}"
                       class="nav-link {% if 'usuarios' in pagina_actual or 'password' in pagina_actual %}active{% endif %}"
                       style="padding-left: 2rem">
                        <i class="fas fa-arrow-alt-circle-right nav-icon"></i>
                        <p>Usuarios</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'grupos' %}"
                       class="nav-link {% if 'grupos' in pagina_actual %}active{% endif %}"
                       style="padding-left: 2rem">
                        <i class="fas fa-arrow-alt-circle-right nav-icon"></i>
                        <p>Grupos</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'dupla_list' %}"
                       class="nav-link {% if 'grupos' in pagina_actual %}active{% endif %}"
                       style="padding-left: 2rem">
                        <i class="fas fa-arrow-alt-circle-right nav-icon"></i>
                        <p>Duplas</p>
                    </a>
                </li>
            </ul>
        </li>
    {% endif %}
    <!-- MENÚ LEGAJOS CON INDENTACIÓN CORRECTA -->
    <li class="nav-item {% if 'comedores' in pagina_actual or 'admisiones' in pagina_actual or 'acompanamiento' in pagina_actual or 'rendicion_cuentas' in pagina_actual or 'organizaciones' in pagina_actual or 'cdi' in pagina_actual or 'ciudadanos' in pagina_actual or 'centros' in pagina_actual %}menu-open{% endif %}">
        <a href="#" class="nav-link">
            <i class="nav-icon fa fa-address-card"></i>
            <p>
                Legajos
                <i class="nav-arrow bi bi-chevron-right"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <!-- CIUDADANOS - Con puntito y flecha -->
            {% if request.user|has_group:"Ciudadanos" %}
                <li class="nav-item {% if 'ciudadanos' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link {% if 'ciudadanos' in pagina_actual %}active{% endif %}"
                       style="padding-left: 1.5rem">
                        <i class="nav-icon far fa-dot-circle"></i>
                        <p>
                            Ciudadanos
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'ciudadanos' %}"
                               class="nav-link {% if 'ciudadanos/listar' in pagina_actual %}active{% endif %}"
                               style="padding-left: 3rem">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Búsqueda</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}
            <!-- COMEDORES - Con puntito, flecha y submenús jerárquicos -->
            {% if request.user|has_group:"Comedor Ver" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Abogado Dupla" or request.user|has_group:"Area Legales" or request.user|has_group:"Comedores Listar" %}
                <li class="nav-item {% if 'comedores' in pagina_actual or 'admisiones' in pagina_actual or 'acompanamiento' in pagina_actual or 'rendicion_cuentas' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link {% if 'comedores' in pagina_actual %}active{% endif %}"
                       style="padding-left: 1.5rem">
                        <i class="nav-icon far fa-dot-circle"></i>
                        <p>
                            Comedores
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <!-- Enlace directo a comedores -->
                        <li class="nav-item">
                            <a href="{% url 'comedores' %}"
                               class="nav-link {% if 'comedores/listar' in pagina_actual %}active{% endif %}"
                               style="padding-left: 3rem">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Ver Comedores</p>
                            </a>
                        </li>
                        <!-- ADMISIÓN - COMEDORES dentro de Comedores -->
                        <li class="nav-item {% if 'admisiones' in pagina_actual %}menu-open{% endif %}">
                            <a href="#" class="nav-link" style="padding-left: 3rem;">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>
                                    Admision - Comedores
                                    <i class="nav-arrow bi bi-chevron-right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="{% url 'admisiones_tecnicos_listar' %}"
                                       class="nav-link {% if 'admisiones_tecnicos' in pagina_actual %}active{% endif %}"
                                       style="padding-left: 4.5rem">
                                        <i class="far fa-dot-circle nav-icon"></i>
                                        <p>Técnicos</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="{% url 'admisiones_legales_listar' %}"
                                       class="nav-link {% if 'admisiones_legales' in pagina_actual %}active{% endif %}"
                                       style="padding-left: 4.5rem">
                                        <i class="far fa-dot-circle nav-icon"></i>
                                        <p>Legales</p>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <!-- ACOMPAÑAMIENTO dentro de Comedores -->
                        {% if request.user|has_group:"Area Legales" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Abogado Dupla" %}
                            <li class="nav-item">
                                <a href="{% url 'lista_comedores_acompanamiento' %}"
                                   class="nav-link {% if 'acompanamiento' in pagina_actual %}active{% endif %}"
                                   style="padding-left: 3rem">
                                    <i class="nav-icon bi bi-arrow-return-right"></i>
                                    <p>Acompañamiento</p>
                                </a>
                            </li>
                        {% endif %}
                        <!-- RENDICIÓN DE CUENTAS FINAL dentro de Comedores -->
                        {% if request.user|has_group:"Area Legales" or request.user|has_group:"Area Contable" or request.user|has_group:"Tecnico Comedor" %}
                            <li class="nav-item">
                                <a href="{% url 'rendicion_cuentas_final_listar' %}"
                                   class="nav-link {% if 'rendicion_cuentas_final/listar' in pagina_actual %}active{% endif %}"
                                   style="padding-left: 3rem">
                                    <i class="nav-icon bi bi-arrow-return-right"></i>
                                    <p>Rendicion de Cuentas Final</p>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </li>
            {% endif %}
            <!-- ORGANIZACIONES - Con puntito y flecha -->
            {% if request.user|has_group:"Organizaciones" %}
                <li class="nav-item {% if 'organizaciones' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link {% if 'organizaciones' in pagina_actual %}active{% endif %}"
                       style="padding-left: 1.5rem">
                        <i class="nav-icon far fa-dot-circle"></i>
                        <p>
                            Organizaciones
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'organizaciones' %}"
                               class="nav-link {% if 'organizaciones/listar' in pagina_actual %}active{% endif %}"
                               style="padding-left: 3rem">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Ver Organizaciones</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}
            <!-- CENTRO DESARROLLO INFANTIL - Con puntito y flecha -->
            {% if request.user|has_group:"CDI" %}
                <li class="nav-item {% if 'cdi' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link {% if 'cdi' in pagina_actual %}active{% endif %}"
                       style="padding-left: 1.5rem">
                        <i class="nav-icon far fa-dot-circle"></i>
                        <p>
                            Centro Desarrollo Infantil
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'cdi' %}"
                               class="nav-link {% if 'cdi/listar' in pagina_actual %}active{% endif %}"
                               style="padding-left: 3rem">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Ver Centro Desarrollo</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}
            <!-- CENTRO DE FAMILIA - Con puntito y flecha -->
            {% if request.user|has_group:"superadmin" or request.user|has_group:"ReferenteCentro" or user %}
                <li class="nav-item {% if 'centros' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link {% if 'centros' in pagina_actual %}active{% endif %}"
                       style="padding-left: 1.5rem">
                        <i class="nav-icon far fa-dot-circle"></i>
                        <p>
                            Centro de Familia
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'centro_list' %}"
                               class="nav-link {% if 'centros/' in pagina_actual %}active{% endif %}"
                               style="padding-left: 3rem">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Ver Centros</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}
        </ul>
    </li>
{% endwith %}
