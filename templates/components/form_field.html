{# Componente Form Field #}
{# Uso: {% include 'components/form_field.html' with field=form.nombre label='Nombre completo' help_text='Ingrese su nombre' required=True %} #}
<div class="form-group {% if col_class %}{{ col_class }}{% endif %} {% if field.errors %}has-error{% endif %}">
    {% if label or field.label %}
        <label for="{{ field.id_for_label }}"
               class="form-label {% if label_class %}{{ label_class }}{% endif %}">
            {{ label|default:field.label }}
            {% if required or field.field.required %}<span class="text-danger">*</span>{% endif %}
        </label>
    {% endif %}
    {% if field_type == 'textarea' %}
        <textarea name="{{ field.name }}"
                  id="{{ field.id_for_label }}"
                  class="form-control {% if field_class %}{{ field_class }}{% endif %} {% if field.errors %}is-invalid{% endif %}"
                  {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
                  {% if rows %}rows="{{ rows }}"{% endif %}
                  {% if required or field.field.required %}required{% endif %}
                  {% if readonly %}readonly{% endif %}
                  {% if disabled %}disabled{% endif %}>{{ field.value|default:'' }}</textarea>
    {% elif field_type == 'select' %}
        <select name="{{ field.name }}"
                id="{{ field.id_for_label }}"
                class="form-select {% if field_class %}{{ field_class }}{% endif %} {% if field.errors %}is-invalid{% endif %}"
                {% if required or field.field.required %}required{% endif %}
                {% if disabled %}disabled{% endif %}>
            {% if empty_option %}<option value="">{{ empty_option }}</option>{% endif %}
            {% if options %}
                {% for option in options %}
                    <option value="{{ option.value }}"
                            {% if option.value == field.value %}selected{% endif %}>{{ option.label }}</option>
                {% endfor %}
            {% else %}
                {{ field.field.widget|safe }}
            {% endif %}
        </select>
    {% elif field_type == 'checkbox' %}
        <div class="form-check {% if checkbox_class %}{{ checkbox_class }}{% endif %}">
            <input type="checkbox"
                   name="{{ field.name }}"
                   id="{{ field.id_for_label }}"
                   class="form-check-input {% if field.errors %}is-invalid{% endif %}"
                   {% if field.value %}checked{% endif %}
                   {% if disabled %}disabled{% endif %}
                   value="1" />
            <label for="{{ field.id_for_label }}" class="form-check-label">
                {{ checkbox_label|default:label|default:field.label }}
            </label>
        </div>
    {% elif field_type == 'radio' %}
        {% if options %}
            {% for option in options %}
                <div class="form-check {% if radio_class %}{{ radio_class }}{% endif %}">
                    <input type="radio"
                           name="{{ field.name }}"
                           id="{{ field.id_for_label }}_{{ forloop.counter }}"
                           class="form-check-input {% if field.errors %}is-invalid{% endif %}"
                           value="{{ option.value }}"
                           {% if option.value == field.value %}checked{% endif %}
                           {% if disabled %}disabled{% endif %} />
                    <label for="{{ field.id_for_label }}_{{ forloop.counter }}"
                           class="form-check-label">{{ option.label }}</label>
                </div>
            {% endfor %}
        {% endif %}
    {% elif field_type == 'file' %}
        <input type="file"
               name="{{ field.name }}"
               id="{{ field.id_for_label }}"
               class="form-control {% if field_class %}{{ field_class }}{% endif %} {% if field.errors %}is-invalid{% endif %}"
               {% if accept %}accept="{{ accept }}"{% endif %}
               {% if required or field.field.required %}required{% endif %}
               {% if disabled %}disabled{% endif %}
               {% if multiple %}multiple{% endif %} />
    {% elif field_type == 'hidden' %}
        <input type="hidden"
               name="{{ field.name }}"
               id="{{ field.id_for_label }}"
               value="{{ field.value|default:'' }}" />
    {% else %}
        {# Input por defecto (text, email, password, number, date, etc.) #}
        <input type="{{ field_type|default:'text' }}"
               name="{{ field.name }}"
               id="{{ field.id_for_label }}"
               class="form-control {% if field_class %}{{ field_class }}{% endif %} {% if field.errors %}is-invalid{% endif %}"
               value="{{ field.value|default:'' }}"
               {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
               {% if required or field.field.required %}required{% endif %}
               {% if readonly %}readonly{% endif %}
               {% if disabled %}disabled{% endif %}
               {% if min %}min="{{ min }}"{% endif %}
               {% if max %}max="{{ max }}"{% endif %}
               {% if step %}step="{{ step }}"{% endif %}
               {% if pattern %}pattern="{{ pattern }}"{% endif %} />
    {% endif %}
    {# Texto de ayuda #}
    {% if help_text or field.help_text %}
        <div class="form-text text-muted">{{ help_text|default:field.help_text }}</div>
    {% endif %}
    {# Errores del campo #}
    {% if field.errors %}
        <div class="invalid-feedback">
            {% for error in field.errors %}
                {{ error }}
                {% if not forloop.last %}<br />{% endif %}
            {% endfor %}
        </div>
    {% endif %}
    {# Input group adicional (prefijo/sufijo) #}
    {% if prefix or suffix %}
        <div class="input-group {% if input_group_class %}{{ input_group_class }}{% endif %}">
            {% if prefix %}<span class="input-group-text">{{ prefix }}</span>{% endif %}
            {# Re-render del input dentro del group #}
            <input type="{{ field_type|default:'text' }}"
                   name="{{ field.name }}"
                   id="{{ field.id_for_label }}"
                   class="form-control {% if field_class %}{{ field_class }}{% endif %} {% if field.errors %}is-invalid{% endif %}"
                   value="{{ field.value|default:'' }}"
                   {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
                   {% if required or field.field.required %}required{% endif %} />
            {% if suffix %}<span class="input-group-text">{{ suffix }}</span>{% endif %}
        </div>
    {% endif %}
</div>
