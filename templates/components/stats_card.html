{# Componente Stats Card #}
{# Uso: {% include 'components/stats_card.html' with title='Usuarios' value='150' icon='fas fa-users' color='primary' url=detail_url %} #}
<div class="{% if col_class %}{{ col_class }}{% else %}col-12 col-sm-6 col-md-3{% endif %}">
    <div class="{% if card_type == 'info-box' %}info-box{% else %}card{% endif %} {% if hover %}card-hover{% endif %} {{ card_class|default:'' }}">
        {% if card_type == 'info-box' %}
            {# Estilo AdminLTE Info Box #}
            <span class="info-box-icon bg-{{ color|default:'primary' }}">
                <i class="{{ icon|default:'fas fa-chart-bar' }}"></i>
            </span>
            <div class="info-box-content">
                <span class="info-box-text">{{ title }}</span>
                <span class="info-box-number">{{ value|default:'0' }}</span>
                {% if subtitle %}<span class="info-box-more">{{ subtitle }}</span>{% endif %}
            </div>
        {% elif card_type == 'small-box' %}
            {# Estilo AdminLTE Small Box #}
            <div class="small-box bg-{{ color|default:'primary' }}">
                <div class="inner">
                    <h3>{{ value|default:'0' }}</h3>
                    <p>{{ title }}</p>
                </div>
                <div class="icon">
                    <i class="{{ icon|default:'fas fa-chart-bar' }}"></i>
                </div>
                {% if url %}
                    <a href="{{ url }}" class="small-box-footer">
                        {{ link_text|default:'Ver más' }} <i class="fas fa-arrow-circle-right"></i>
                    </a>
                {% endif %}
            </div>
        {% else %}
            {# Estilo Card Bootstrap personalizado #}
            <div class="card-body {% if url %}card-link-hover{% endif %}">
                <div class="d-flex align-items-center">
                    {% if icon %}
                        <div class="flex-shrink-0">
                            <div class="stat-icon bg-{{ color|default:'primary' }}-light text-{{ color|default:'primary' }}">
                                <i class="{{ icon }}"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                        {% else %}
                            <div class="flex-grow-1">
                            {% endif %}
                            {% if title %}<div class="stat-title text-muted small">{{ title }}</div>{% endif %}
                            <div class="stat-value h4 mb-0 text-{{ color|default:'dark' }}">{{ value|default:'0' }}</div>
                            {% if subtitle %}<div class="stat-subtitle text-muted small">{{ subtitle }}</div>{% endif %}
                            {% if change %}
                                <div class="stat-change small">
                                    {% if change.type == 'increase' %}
                                        <i class="fas fa-arrow-up text-success"></i>
                                        <span class="text-success">+{{ change.value }}%</span>
                                    {% elif change.type == 'decrease' %}
                                        <i class="fas fa-arrow-down text-danger"></i>
                                        <span class="text-danger">-{{ change.value }}%</span>
                                    {% else %}
                                        <i class="fas fa-minus text-warning"></i>
                                        <span class="text-warning">{{ change.value }}%</span>
                                    {% endif %}
                                    {% if change.period %}<span class="text-muted">vs {{ change.period }}</span>{% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% if progress %}
                        <div class="mt-3">
                            <div class="progress" style="height: 4px;">
                                <div class="progress-bar bg-{{ color|default:'primary' }}"
                                     role="progressbar"
                                     style="width: {{ progress.value|default:'0' }}%"
                                     aria-valuenow="{{ progress.value|default:'0' }}"
                                     aria-valuemin="0"
                                     aria-valuemax="100"></div>
                            </div>
                            {% if progress.text %}<small class="text-muted">{{ progress.text }}</small>{% endif %}
                        </div>
                    {% endif %}
                </div>
                {% if url %}
                    <a href="{{ url }}" class="card-footer text-center text-decoration-none">
                        <small class="text-{{ color|default:'primary' }}">
                            {{ link_text|default:'Ver más' }} <i class="fas fa-arrow-right ms-1"></i>
                        </small>
                    </a>
                {% endif %}
            {% endif %}
            {# Overlay de loading opcional #}
            {% if loading %}
                <div class="card-loading-overlay">
                    <div class="spinner-border text-{{ color|default:'primary' }}"
                         role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    {# CSS personalizado #}
    <style>
    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }
    
    {% if color == 'primary' %}
        .bg-primary-light { background-color: rgba(13, 110, 253, 0.1) !important; }
    {% elif color == 'success' %}
        .bg-success-light { background-color: rgba(25, 135, 84, 0.1) !important; }
    {% elif color == 'danger' %}
        .bg-danger-light { background-color: rgba(220, 53, 69, 0.1) !important; }
    {% elif color == 'warning' %}
        .bg-warning-light { background-color: rgba(255, 193, 7, 0.1) !important; }
    {% elif color == 'info' %}
        .bg-info-light { background-color: rgba(13, 202, 240, 0.1) !important; }
    {% endif %}
    
    .card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    
    .card-link-hover {
        cursor: {% if url %}pointer{% else %}default{% endif %};
    }
    
    .card-loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.375rem;
    }
    </style>
