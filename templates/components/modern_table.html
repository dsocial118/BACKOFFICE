{% comment %} Componente reutilizable para mostrar tablas de historial
Parámetros: - items: Lista de items a mostrar (requerido) - table_title: Título
de la tabla (requerido) - table_icon: Icono del título (default: "fas
fa-history") - columns: Lista de columnas con format: [{'field': 'campo',
'label': 'Etiqueta', 'type': 'text|date|link'}] - actions: Lista de acciones por
item con format: [{'url_name': 'nombre_url', 'label': 'Texto', 'icon':
'fa-icon', 'class': 'btn-class'}] - empty_message: Mensaje cuando no hay items
(default: "No hay registros") - show_index: Mostrar numeración (default: False)
- compact: Tabla compacta (default: False) - url_params: Parámetros adicionales
para las URLs de acciones (opcional) {% endcomment %} {% load static %}

<div class="card modern-table-card">
  <div class="card-header section-header">
    <h3 class="section-title">
      <i class="{{ table_icon|default:'fas fa-history' }}"></i>
      {{ table_title }} {% if items %}
      <span class="badge bg-light text-dark ms-2">{{ items|length }}</span>
      {% endif %}
    </h3>
    <div class="card-tools">
      <button
        type="button"
        class="btn btn-tool text-white d-md-none"
        data-card-widget="collapse"
      >
        <i class="fas fa-minus"></i>
      </button>
    </div>
  </div>

  <div class="card-body table-responsive p-0">
    {% if items %}
    <table class="table table-hover table-striped modern-table">
      <thead class="table-header">
        <tr>
          {% if show_index %}
          <th class="text-center" style="width: 60px">#</th>
          {% endif %} {% for column in columns %}
          <th>{{ column.label }}</th>
          {% endfor %} {% if actions %}
          <th class="text-center" style="width: 120px">Acciones</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr class="table-row">
          {% if show_index %}
          <td class="text-center text-muted">{{ forloop.counter }}</td>
          {% endif %} {% for column in columns %}
          <td>
            {% if column.type == 'date' %}
            <i class="fas fa-calendar-alt me-1 text-muted"></i>
            {% with item|getattr:column.field as field_value %} {{
            field_value|date:'d/m/Y' }} {% endwith %} {% elif column.type ==
            'datetime' %}
            <i class="fas fa-clock me-1 text-muted"></i>
            {% with item|getattr:column.field as field_value %} {{
            field_value|date:'d/m/Y H:i' }} {% endwith %} {% elif column.type ==
            'link' and column.url_name %}
            <a
              href="{% url column.url_name item.id %}"
              class="text-primary text-decoration-none"
            >
              {% if column.icon %}<i class="{{ column.icon }} me-1"></i>{% endif
              %} {% with item|getattr:column.field as field_value %} {{
              field_value }} {% endwith %}
            </a>
            {% elif column.type == 'badge' %} {% with item|getattr:column.field
            as field_value %}
            <span class="badge bg-{{ column.badge_class|default:'secondary' }}">
              {{ field_value }}
            </span>
            {% endwith %} {% else %} {% with item|getattr:column.field as
            field_value %} {{ field_value }} {% endwith %} {% endif %}
          </td>
          {% endfor %} {% if actions %}
          <td class="text-center">
            <div class="btn-group btn-group-sm">
              {% for action in actions %}
              <a
                href="{% url action.url_name item.id url_params.0 url_params.1 %}"
                class="btn {{ action.class|default:'btn-outline-primary' }}"
                title="{{ action.label }}"
              >
                <i class="{{ action.icon }}"></i>
                {% if not compact %}{{ action.label }}{% endif %}
              </a>
              {% endfor %}
            </div>
          </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="empty-state text-center py-5">
      <div class="mb-3">
        <i
          class="{{ table_icon|default:'fas fa-history' }} fa-3x text-muted opacity-50"
        ></i>
      </div>
      <h6 class="text-muted font-weight-normal">
        {{ empty_message|default:"No hay registros" }}
      </h6>
      <p class="text-muted small">
        Los registros aparecerán aquí cuando sean creados
      </p>
    </div>
    {% endif %}
  </div>
</div>

<style>
  /* Estilos para tabla moderna */
  .modern-table-card {
    border: none;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(32, 201, 151, 0.1);
    background: rgba(255, 255, 255, 0.98);
    margin-bottom: 1.5rem;
  }

  .section-header {
    background: linear-gradient(135deg, #20c997, #17a2b8);
    color: white;
    padding: 1.5rem 2rem;
    border: none;
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .modern-table {
    margin: 0;
  }

  .table-header th {
    background: rgba(32, 201, 151, 0.1);
    border: none;
    padding: 1rem 1.5rem;
    font-weight: 600;
    color: #2c3e50;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .table-row td {
    padding: 1rem 1.5rem;
    border: none;
    border-bottom: 1px solid rgba(32, 201, 151, 0.1);
    color: #2c3e50;
    vertical-align: middle;
  }

  .table-row:hover {
    background: rgba(32, 201, 151, 0.05);
  }

  .table-row:last-child td {
    border-bottom: none;
  }

  .btn-group-sm .btn {
    border-radius: 6px;
    font-weight: 500;
  }

  .btn-outline-primary {
    border-color: #20c997;
    color: #20c997;
  }

  .btn-outline-primary:hover {
    background: #20c997;
    border-color: #20c997;
    color: white;
  }

  .btn-outline-danger {
    border-color: #dc3545;
    color: #dc3545;
  }

  .btn-outline-danger:hover {
    background: #dc3545;
    border-color: #dc3545;
    color: white;
  }

  .empty-state {
    padding: 3rem 2rem;
  }

  .badge {
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .table-header th,
    .table-row td {
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
    }

    .btn-group-sm .btn {
      padding: 0.25rem 0.5rem;
    }

    .section-title {
      font-size: 1.1rem;
    }
  }
</style>

<!-- Nota: Este componente necesitará un templatetag personalizado para getattr -->
<!-- Por ahora usaremos una solución alternativa con JavaScript si es necesario -->

<script>
  // Función para manejar acciones de tabla
  function handleTableAction(action, itemId) {
    if (action === "delete") {
      if (confirm("¿Está seguro de que desea eliminar este registro?")) {
        // Implementar lógica de eliminación
        return true;
      }
      return false;
    }
    return true;
  }
</script>
