{% extends "includes/main.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block title %}Alertas{% endblock %}
{% block titulo-pagina %}Ciudadano{% endblock %}
{% block breadcrumb %}
    {% include 'components/breadcrumb.html' with items=breadcrumb_items %}
{% endblock %}
{% block menu-adicional %}{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-md-12">
            <div class="card card-primary card-outline">
                <div class="card-body">
                    {% include 'components/ciudadano_stepper_alertas.html' with object=ciudadano %}
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title font-weight-bold ">Agregar alerta</h3>
                                </div>
                                <div class="card-body">
                                    <form id="agregarAlerta"
                                          name="agregarAlerta"
                                          method="POST"
                                          autocomplete="off"
                                          novalidate>
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="form-group col-auto">{{ form.categoria| as_crispy_field }}</div>
                                            <div class="form-group col-auto">{{ form.nombre| as_crispy_field }}</div>
                                            <div class="form-group col-auto mt-2">
                                                <button class="btn btn-primary mt-sm-4 mt-0" type="submit">Agregar</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title font-weight-bold">Alertas</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        {% for a in alertas %}
                                            <div class="col-sm-3 px-2 " id="alerta-{{ a.id }}">
                                                <button type="button"
                                                        class="close pr-1 eliminar-alerta-btn"
                                                        title="Eliminar alerta"
                                                        data-alerta-id="{{ a.pk }}">Ã—</button>
                                                <div class="callout callout-{{ a.alerta.gravedad }} ">
                                                    <h6 class="font-weight-bold">
                                                        <i class="fas fa-exclamation-triangle px-1"></i>
                                                        {{ a.alerta }}
                                                    </h6>
                                                </div>
                                            </div>
                                        {% empty %}
                                            <div class="col-12 text-center">
                                                <h6 class="text-muted">Sin alertas</h6>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- botones del pie -->
                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="form-group mb-0 mt-3 d-flex justify-content-between">
                            <a href="{% url 'grupofamiliar_crear' ciudadano.pk %}"
                               class="btn btn-secondary mb-3">Volver</a>
                            <a href="{% url 'ciudadanos_ver' ciudadano.pk %}"
                               class="btn btn-primary mb-3">Guardar</a>
                            <a href="{% url 'ciudadanosarchivos_crear' ciudadano.pk %}"
                               class="btn btn-secondary mb-3 float-right">Continuar</a>
                        </div>
                    </div>
                </div>
                <!-- /botones del pie -->
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block customJS %}
    <script>
    const alertasSelectUrl = '{% url "alertas_select" %}';
    const categoriasSelectUrl = '{% url "categorias_select" %}';
    const alertaAjaxBorrarUrl = '{% url "alerta_ajax_borrar" %}';
    </script>
    <script src="{% static 'custom/js/ciudadanosalertas.js' %}"></script>
{% endblock %}
